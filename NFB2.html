<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>NFB2 기종선정 시트</title>
    
    <!-- 소스 보호 스크립트 (NFHC2와 동일) -->
    <script>
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            return false;
        });
        document.addEventListener('keydown', function(e) {
            if (e.key === 'F12') {
                e.preventDefault();
                return false;
            }
            if (e.ctrlKey) {
                if (e.shiftKey && (e.key === 'I' || e.key === 'J' || e.key === 'C')) {
                    e.preventDefault();
                    return false;
                }
                if (e.key === 'u' || e.key === 's' || e.key === 'a' || e.key === 'p') {
                    e.preventDefault();
                    return false;
                }
            }
        });
        document.addEventListener('selectstart', function(e) {
            e.preventDefault();
            return false;
        });
        document.addEventListener('dragstart', function(e) {
            e.preventDefault();
            return false;
        });
        let devtools = {open: false, orientation: null};
        setInterval(function() {
            if (window.outerHeight - window.innerHeight > 160 || window.outerWidth - window.innerWidth > 160) {
                if (!devtools.open) {
                    devtools.open = true;
                    alert('개발자 도구가 감지되었습니다. 페이지가 새로고침됩니다.');
                    window.location.reload();
                }
            } else {
                devtools.open = false;
            }
        }, 500);
        document.addEventListener('copy', function(e) {
            e.preventDefault();
            return false;
        });
        window.addEventListener('beforeprint', function(e) {
            e.preventDefault();
            alert('인쇄가 금지되어 있습니다.');
            return false;
        });
    </script>
    <style>
        body { 
            font-family: 'Arial', sans-serif; 
            background: #f0f2f5; 
            margin: 0; 
            padding: 0; 
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
        }
        .container {
            max-width: 1100px;
            margin: 30px auto;
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 8px #0001;
            padding: 30px;
        }
        .header-row { display: flex; align-items: flex-start; justify-content: space-between; margin-bottom: 10px; }
        .title { font-size: 2em; font-weight: bold; color: #1a73e8; text-align: center; flex: 1; }
        .order-row { display: flex; align-items: center; margin-bottom: 20px; }
        .order-label, .order-value { font-size: 1.21em; }
        .order-label { font-weight: bold; margin-right: 10px; }
        .order-value { font-size: 1.21em; font-weight: bold; color: #333; margin-left: 10px; padding: 5px 10px; display: none; }
        .order-value.show { display: inline-block; }
        .step-title { font-size: 1.1em; font-weight: bold; margin-bottom: 15px; }
        table { width: 98%; margin: 0 auto 15px auto; border-collapse: collapse; }
        th, td { padding: 8px 5px 8px 5px; border: 1px solid #e5e7eb; }
        th { background: #f5f5f5; }
        .input-cell { background: #e8f5e9; }
        .input-cell input[type="number"], .input-cell select { width: 100%; max-width: 100%; min-width: 0; box-sizing: border-box; }
        .step-flex-row { display: flex; align-items: stretch; gap: 30px; margin-bottom: 30px; }
        .grip-image-area { flex: 0 0 180px; display: flex; flex-direction: column; align-items: center; justify-content: center; background: #f8f9fa; border-radius: 8px; min-height: 180px; max-width: 200px; }
        .grip-image-area img { width: 120px; height: auto; display: block; }
        .grip-image-label { font-size: 1em; color: #333; font-weight: bold; text-align: center; margin-top: 8px; }
        .result-values-area { flex: 1; display: flex; flex-direction: column; justify-content: center; }
        .forces-display { display: flex; justify-content: space-between; margin-bottom: 20px; }
        .force-item { text-align: center; flex: 1; }
        .force-label { font-weight: bold; color: #666; margin-bottom: 5px; }
        .force-value { font-size: 1.2em; color: #333; }
        .progress-section { margin-top: 10px; text-align: center; }
        .progress-bar { width: 100%; height: 30px; background: #f0f0f0; border-radius: 4px; overflow: hidden; margin-bottom: 5px; position: relative; }
        .progress-fill { height: 100%; background: #e0e0e0; transition: width 0.3s, background 0.3s; position: absolute; left: 0; top: 0; }
        .progress-text { position: absolute; width: 100%; text-align: center; line-height: 30px; color: #666; }
        .progress-status { text-align: center; margin-top: 5px; color: #666; }
        .final-judgment { margin-top: 20px; padding: 20px; background: #f8f9fa; border: 1px solid #ddd; border-radius: 8px; text-align: center; }
        .judgment-title { font-size: 1.2em; font-weight: bold; margin-top: 15px; margin-bottom: 10px; color: #333; }
        .judgment-result { font-size: 1.5em; font-weight: bold; padding: 10px; border-radius: 4px; background: #4CAF50; color: #fff; display: inline-block; min-width: 200px; }
        .final-images { margin-top: 15px; display: flex; gap: 20px; align-items: center; justify-content: center; }
        .final-images img { height: auto; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .final-images .orient { display: flex; gap: 20px; align-items: center; }
        .final-images .orient figure { margin: 0; text-align: center; }
        .final-images .orient img { height: 140px; width: auto; }
        .final-images .ref img { height: 160px; width: auto; }
        /* STEP 3 스타일 (NFHC2와 동일) */
        .step3-container { display: flex; gap: 20px; margin-top: 20px; }
        .step3-tables { flex: 2; display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .step3-results { flex: 1; display: flex; flex-direction: column; gap: 20px; }
        .force-table { border: 2px solid #ddd; border-radius: 8px; overflow: hidden; background: white; }
        .table-header { background: #f8f9fa; padding: 10px; font-weight: bold; text-align: center; border-bottom: 1px solid #ddd; }
        .calculation-table { width: 100%; border-collapse: collapse; }
        .calculation-table td { padding: 8px 12px; border-bottom: 1px solid #eee; font-size: 0.9em; }
        .param-name { background: #f8f9fa; font-weight: 500; width: 60%; }
        .param-value { text-align: right; width: 40%; }
        .result-row { background: #fff5f5; }
        .result-value { color: #d32f2f; font-weight: bold; }
        .final-check { height: fit-content; }
        .total-ratio-display { padding: 15px; text-align: center; }
        .total-ratio-value { font-size: 2em; color: #2196F3; font-weight: bold; margin-bottom: 10px; }
        .total-ratio-desc { text-align: center; font-size: 14px; font-weight: normal; color: #666; margin-top: 10px; padding: 5px; }
        .force-check-results { padding: 10px; }
        .force-check-item { display: flex; justify-content: space-between; margin-bottom: 8px; padding: 5px; border-radius: 4px; }
        .force-check-item.failed { background-color: #ffebee; border: 1px solid #f44336; }
        .force-result { font-weight: bold; padding: 2px 8px; border-radius: 3px; }
        .force-result.ok { color: #4CAF50; background-color: #e8f5e8; }
        .force-result.no { color: #f44336; background-color: #ffebee; }
        select { width: 100%; padding: 12px 8px; height: 40px; border: 1px solid #ddd; border-radius: 4px; background-color: #ffffff; }
        input[type="number"] { width: 100%; max-width: 120px; padding: 12px 8px; height: 40px; border: 1px solid #ddd; border-radius: 4px; background-color: #ffffff; text-align: left; word-break: keep-all; overflow: hidden; box-sizing: border-box; }
        .grip-diagram2-area { flex: 0 0 180px; display: flex; flex-direction: column; align-items: center; justify-content: center; background: #f8f9fa; border-radius: 8px; min-height: 180px; max-width: 200px; }
        .grip-diagram2-area img { width: 120px; height: auto; display: block; }
        @media (max-width: 1200px) {
            .step-flex-row { flex-direction: column; }
            .grip-image-area, .grip-diagram2-area { max-width: 100%; }
        }
    </style>
    
</head>
<body>
<div class="container">
    <div style="display: flex; align-items: flex-start; justify-content: space-between; margin-bottom: 10px;">
        <div style="flex:2; text-align:right;">
            <div style="font-size:1.5em; font-weight:bold; color:#1a73e8; margin-bottom:10px;">NFB2 기종선정 시트</div>
        </div>
        <div style="flex:1; text-align:right;">
            <img src="images/NFB2.PNG" alt="NFB2 로고" style="width:auto; height:120px;">
        </div>
    </div>

    <div class="order-row">
        <span class="order-label">주문 품번:</span>
        <span class="order-value" id="orderNumber"></span>
    </div>

    <!-- STEP 1 -->
    <div class="step">
        <h2 class="step-title">STEP 1. 기본 사용조건과 대상 에어척 사양 입력하여 실효 파지력 확인</h2>
        <table>
            <colgroup>
                <col style="width: 25%;">
                <col style="width: 25%;">
                <col style="width: 10%;">
                <col style="width: 40%;">
            </colgroup>
            <tr>
                <th>파라미터</th><th>입력값</th><th>단위</th><th>설명</th>
            </tr>
            <tr>
                <td>파지 방법</td>
                <td class="input-cell">
                    <select id="gripMethod">
                        <option value="">선택</option>
                        <option value="외경 파지">외경 파지</option>
                        <option value="내경 파지">내경 파지</option>
                    </select>
                </td>
                <td>-</td>
                <td>외경 파지 또는 내경 파지 선택</td>
            </tr>
            <tr>
                <td>실린더 내경</td>
                <td class="input-cell">
                    <select id="diameter">
                        <option value="">선택</option>
                        <option value="008">Ø8</option>
                        <option value="012">Ø12</option>
                        <option value="016">Ø16</option>
                        <option value="020">Ø20</option>
                    </select>
                </td>
                <td>-</td>
                <td>에어척 내경 선택</td>
            </tr>
            <tr>
                <td>작동 방식</td>
                <td class="input-cell">
                    <select id="operationType" disabled>
                        <option value="D" selected>D</option>
                    </select>
                </td>
                <td>-</td>
                <td>D : 복동 (고정)</td>
            </tr>
            <tr>
                <td>사용 압력</td>
                <td class="input-cell">
                    <select id="pressure">
                        <option value="">선택</option>
                    </select>
                </td>
                <td>MPa</td>
                <td>사용압력 선택 [0.2~0.7MPa]</td>
            </tr>
            <tr>
                <td>부하량</td>
                <td class="input-cell"><input type="number" id="load" step="0.001" min="0.001" max="4.3" placeholder="0.001 ~ 4.3"></td>
                <td>kg</td>
                <td>적재 질량 입력 [0.001~4.3kg]</td>
            </tr>
            <tr>
                <td>안전율</td>
                <td class="input-cell"><input type="number" id="safetyFactor" min="5" max="20" placeholder="5 ~ 20"></td>
                <td>-</td>
                <td>적재 질량 대비 확보해야할 파지력의 배수 [5~20]</td>
            </tr>
            <tr>
                <td>취부자세</td>
                <td class="input-cell">
                    <select id="mountOrientation">
                        <option value="">선택</option>
                        <option value="수평취부(천장)">수평취부(천장)</option>
                        <option value="수평벽취부">수평벽취부</option>
                    </select>
                </td>
                <td>-</td>
                <td>취부자세 선택</td>
            </tr>
            <tr>
                <td>파지점 L</td>
                <td class="input-cell"><input type="number" id="gripPoint" min="4" max="100" placeholder="4 ~ 100"></td>
                <td>mm</td>
                <td>LM Block 상면에서부터 부하중심까지의 거리 [4~100mm]</td>
            </tr>
            <tr>
                <td>오버행량 H</td>
                <td class="input-cell"><input type="number" id="overhang" min="0" max="100" placeholder="0 ~ 100"></td>
                <td>mm</td>
                <td>에어척 중심으로부터 부하중심까지 수평 거리 [0~100mm]</td>
            </tr>
            <tr>
                <td>2차전지 대응 사양</td>
                <td class="input-cell">
                    <select id="batterySpec">
                        <option value="">선택</option>
                        <option value="">무기호 : 표준형</option>
                        <option value="2B">2B : 2차전지사양</option>
                    </select>
                </td>
                <td>-</td>
                <td>2차전지 대응 시리즈</td>
            </tr>
            <tr>
                <td>오토스위치 종류</td>
                <td class="input-cell">
                    <select id="autoSwitchType">
                        <option value="">선택</option>
                        <option value="W9H">W9H</option>
                        <option value="W9V">W9V</option>
                        <option value="W10V">W10V</option>
                        <option value="W20H">W20H</option>
                    </select>
                </td>
                <td>-</td>
                <td>오토스위치 종류 선택</td>
            </tr>
            <tr>
                <td>오토스위치 수량</td>
                <td class="input-cell">
                    <select id="autoSwitchQuantity">
                        <option value="">선택</option>
                        <option value="2개 부착">2개 부착</option>
                        <option value="1개 부착">1개 부착</option>
                        <option value="N개 부착">N개 부착</option>
                    </select>
                </td>
                <td>-</td>
                <td>오토스위치 수량 선택</td>
            </tr>
        </table>
    </div>

    <div class="final-images" id="finalImages" style="margin:10px 0 0 0;">
        <div class="orient">
          <img src="images/NFB2_img2.PNG" alt="수평취부(천장)">
          <img src="images/NFB2_img4.PNG" alt="수평벽취부)">
        </div>
      </div>
    <!-- STEP1 결과 + 그림 -->
    <div class="step-flex-row">
        <div class="grip-image-area">
            <img id="gripTypeImg" src="images/NFB2_img1.PNG" alt="파지 방법 그림" style="display:block;">
            <div class="grip-image-label" id="gripTypeLabel"></div>
        </div>
        <div class="result-values-area">
            <div class="forces-display">
                <div class="force-item">
                    <div class="force-label">실효파지력(F)</div>
                    <div class="force-value" id="actualForce">- N</div>
                </div>
                <div class="force-item">
                    <div class="force-label">필요파지력(F')</div>
                    <div class="force-value" id="requiredForce">- N</div>
                </div>
            </div>
            <div class="progress-section">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressBar" style="width: 0%">
                        <div class="progress-text">-%</div>
                    </div>
                </div>
                <div class="progress-status" id="progressStatus">-</div>
            </div>
        </div>
    </div>



    <!-- STEP 2 -->
    <div class="step-title">STEP 2. 파지력 확인이 '적용가능'인 경우 파지점, 오버행량 확인</div>
    <div class="step-flex-row">
        <div class="grip-diagram2-area">
            <img src="images/NFB2_img3.PNG" alt="파지점/오버행량 참조">
        </div>
        <div class="result-values-area">
            <div class="forces-display">
                <div class="force-item">
                    <div class="force-label">현재 파지점+오버행량</div>
                    <div class="force-value" id="currentGripPoint">- mm</div>
                </div>
                <div class="force-item">
                    <div class="force-label">허용 범위</div>
                    <div class="force-value" id="maxGripPoint">- mm</div>
                </div>
            </div>
            <div class="progress-section">
                <div class="progress-bar">
                    <div class="progress-fill" id="gripProgressBar" style="width: 0%">
                        <div class="progress-text">-%</div>
                    </div>
                </div>
                <div class="progress-status" id="gripProgressStatus">-</div>
            </div>
        </div>
    </div>

    <!-- STEP 3 -->
    <div class="step" id="step3Section" style="display: none;">
        <h2 class="step-title">STEP 3. 파지력, 파지점&오버행량 '적용가능'인 경우 핑거에 가해지는 외력 확인</h2>
        <div class="step3-container">
            <div class="step3-tables">
                <div class="force-table">
                    <div class="table-header">허용중량</div>
                    <table class="calculation-table">
                        <tr>
                            <td class="param-name">허용중량(Wa)</td>
                            <td class="param-value" id="allowedLoad">- N</td>
                        </tr>
                        <tr>
                            <td class="param-name">허용적재하중계수</td>
                            <td class="param-value" id="loadFactor">-</td>
                        </tr>
                        <tr>
                            <td class="param-name">수직최대허용하중(Wmax)</td>
                            <td class="param-value" id="maxVerticalLoad">- N</td>
                        </tr>
                        <tr class="result-row">
                            <td class="param-name">허용하중 부하율 α1</td>
                            <td class="param-value result-value" id="loadRatio">-</td>
                        </tr>
                    </table>
                </div>
                <div class="force-table">
                    <div class="table-header">Pitching하중</div>
                    <table class="calculation-table">
                        <tr>
                            <td class="param-name">Pitching하중(Fp)</td>
                            <td class="param-value" id="pitchingForce">- N</td>
                        </tr>
                        <tr>
                            <td class="param-name">Pitching 허용횡하중(Fpmax)</td>
                            <td class="param-value" id="maxPitchingForce">-</td>
                        </tr>
                        <tr>
                            <td class="param-name">Pitching모멘트(Mp)</td>
                            <td class="param-value" id="pitchingMoment">- N.m</td>
                        </tr>
                        <tr>
                            <td class="param-name">Pitching모멘트(Mp')</td>
                            <td class="param-value" id="pitchingMomentAlt">- N.m</td>
                        </tr>
                        <tr>
                            <td class="param-name">허용모멘트계수</td>
                            <td class="param-value" id="momentFactor">-</td>
                        </tr>
                        <tr>
                            <td class="param-name">허용Pitching모멘트(Mpmax)</td>
                            <td class="param-value" id="maxPitchingMoment">- N.m</td>
                        </tr>
                        <tr class="result-row">
                            <td class="param-name">Pitching 모멘트 부하율 α2</td>
                            <td class="param-value result-value" id="pitchingRatio">-</td>
                        </tr>
                    </table>
                </div>
                
                <div class="force-table">
                    <div class="table-header">Rolling하중</div>
                    <table class="calculation-table">
                        <tr>
                            <td class="param-name">Rolling하중(Fr)</td>
                            <td class="param-value" id="rollingForce">- N</td>
                        </tr>
                        <tr>
                            <td class="param-name">Rolling 허용횡하중(Frmax)</td>
                            <td class="param-value" id="maxRollingForce">-</td>
                        </tr>
                        <tr>
                            <td class="param-name">Rolling모멘트(Mr)</td>
                            <td class="param-value" id="rollingMoment">- N.m</td>
                        </tr>
                        <tr>
                            <td class="param-name">Rolling모멘트(Mr')</td>
                            <td class="param-value" id="rollingMomentAlt">- N.m</td>
                        </tr>
                        <tr>
                            <td class="param-name">허용모멘트계수</td>
                            <td class="param-value" id="rollingMomentFactor">-</td>
                        </tr>
                        <tr>
                            <td class="param-name">허용Rolling모멘트(Mrmax)</td>
                            <td class="param-value" id="maxRollingMoment">- N.m</td>
                        </tr>
                        <tr class="result-row">
                            <td class="param-name">Rolling모멘트 부하율 α3</td>
                            <td class="param-value result-value" id="rollingRatio">-</td>
                        </tr>
                    </table>
                </div>
            </div>
            <div class="step3-results">
                <div class="force-table final-check">
                    <div class="table-header">각 방향의 힘하중</div>
                    <div class="force-check-results">
                        <div class="force-check-item">
                            <span>Pitching: </span>
                            <span class="force-result" id="pitchingCheck">-</span>
                        </div>
                        
                        <div class="force-check-item">
                            <span>Rolling: </span>
                            <span class="force-result" id="rollingCheck">-</span>
                        </div>
                        <div class="final-result-desc">Fp, Fr < Fmax 이면 적용 가능</div>
                    </div>
                </div>
                <div class="force-table final-check">
                    <div class="table-header">총 부하율</div>
                    <div class="total-ratio-display">
                        <div class="total-ratio-value" id="totalRatio">-</div>
                        <div class="total-ratio-desc">(α1+α2+α3) ≤1 이면 적용 가능</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="final-judgment">
        <div class="judgment-title">종합 판정</div>
        <div class="judgment-result" id="finalResult">값을 모두 입력하세요</div>
    </div>
</div>

<script>
// 상수 설정
const GRAVITY = 9.8; // 요청 산식 준수

// 압력 옵션 (D 고정, 각 내경 동일값 제공)
const pressureOptions = {
    'D': {
        '008': [0.2, 0.3, 0.4, 0.5, 0.6, 0.7],
        '012': [0.2, 0.3, 0.4, 0.5, 0.6, 0.7],
        '016': [0.2, 0.3, 0.4, 0.5, 0.6, 0.7],
        '020': [0.2, 0.3, 0.4, 0.5, 0.6, 0.7]
    }
};

function updatePressureOptions() {
    const diameter = document.getElementById('diameter').value;
    const pressureSelect = document.getElementById('pressure');
    const operationType = 'D';
    const previousSelected = pressureSelect.value;

    pressureSelect.innerHTML = '<option value="">선택</option>';

    if (!diameter) {
        pressureSelect.innerHTML = '<option value="">내경을 먼저 선택하세요</option>';
        return;
    }

    const available = pressureOptions[operationType] && pressureOptions[operationType][diameter]
        ? pressureOptions[operationType][diameter] : [];
    if (available.length === 0) {
        pressureSelect.innerHTML = '<option value="">해당 내경의 압력 데이터 없음</option>';
        return;
    }

    pressureSelect.innerHTML = '<option value="">선택</option>';
    const strs = available.map(p => p.toFixed(2));
    available.forEach(p => {
        const o = document.createElement('option');
        o.value = p.toFixed(2);
        o.textContent = p.toFixed(2);
        pressureSelect.appendChild(o);
    });

    if (previousSelected && strs.includes(previousSelected)) {
        pressureSelect.value = previousSelected;
        calculateResults();
    }
}

// 파지방법 이미지: 구분 없이 동일 이미지 출력
function updateGripTypeImage() {
    const gripMethod = document.getElementById('gripMethod').value;
    const img = document.getElementById('gripTypeImg');
    const label = document.getElementById('gripTypeLabel');
    img.src = 'images/NFB2_img1.PNG';
    img.style.display = 'block';
    label.textContent = gripMethod ? gripMethod : '';
}

// 허용 파지점 데이터 (NFB2용 - Ø별 압력별 허용범위)
const allowedRangeData = {
    '008': {
        '외경 파지': {
            '0.2': 40, '0.3': 32, '0.4': 22, '0.5': 17, '0.6': 12, '0.7': 10
        },
        '내경 파지': {
            '0.2': 40, '0.3': 32, '0.4': 22, '0.5': 17, '0.6': 12, '0.7': 10
        }
    },
    '012': {
        '외경 파지': {
            '0.2': 60, '0.3': 50, '0.4': 40, '0.5': 30, '0.6': 25, '0.7': 20
        },
        '내경 파지': {
            '0.2': 60, '0.3': 50, '0.4': 40, '0.5': 30, '0.6': 25, '0.7': 20
        }
    },
    '016': {
        '외경 파지': {
            '0.2': 80, '0.3': 75, '0.4': 55, '0.5': 42, '0.6': 32, '0.7': 27
        },
        '내경 파지': {
            '0.2': 80, '0.3': 75, '0.4': 55, '0.5': 42, '0.6': 32, '0.7': 27
        }
    },
    '020': {
        '외경 파지': {
            '0.2': 100, '0.3': 90, '0.4': 72, '0.5': 58, '0.6': 44, '0.7': 38
        },
        '내경 파지': {
            '0.2': 100, '0.3': 90, '0.4': 72, '0.5': 58, '0.6': 44, '0.7': 38
        }
    }
};

function getAllowedRange(diameter, pressure, gripMethod) {
    const pressureKey = pressure.toFixed(1);
    const data = allowedRangeData[diameter];
    if (!data) return 0;
    
    const gripData = data[gripMethod];
    if (!gripData) return 0;
    
    return gripData[pressureKey] || 0;
}

// 실효 파지력 계산 (NFB2용 공식 적용)
function calculateEffectiveGripForce(diameter, pressure, gripMethod) {
    if (!diameter || !pressure || !gripMethod) return 0;
    
    const diameterMmMap = { '008': 8, '012': 12, '016': 16, '020': 20 };
    const coeffMap = { '008': 0.95, '012': 0.95, '016': 0.96, '020': 0.98 };
    const dMm = diameterMmMap[diameter];
    if (!dMm) return 0;

    // 요청 산식: area_cm2 = PI * (직경*0.1/2)^2, Force = area_cm2 * Pressure(MPa) * 10.02 * 9.8 * coeff
    const pMPa = parseFloat(pressure);
    const radiusCm = (dMm * 0.1) / 2; // mm -> cm 후 반지름
    const areaCm2 = Math.PI * Math.pow(radiusCm, 2);
    const coeff = coeffMap[diameter] || 1;
    const forceN = areaCm2 * pMPa * 10.02 * GRAVITY * coeff;
    return Math.max(0, forceN);
}

// 주문 품번
function generateOrderNumber() {
    let orderNumber = '';
    const batterySpec = document.getElementById('batterySpec').value;
    const diameter = document.getElementById('diameter').value; // '008' 등
    const autoSwitchType = document.getElementById('autoSwitchType').value;
    const autoSwitchQuantity = document.getElementById('autoSwitchQuantity').value;

    if (batterySpec === '2B') {
        orderNumber += '2B-NFB2-';
    } else {
        orderNumber += 'NFB2-';
    }

    if (diameter) {
        const diameterNum = String(parseInt(diameter, 10));
        orderNumber += diameterNum;
    }
    orderNumber += 'D';

    if (autoSwitchType) {
        orderNumber += '-' + autoSwitchType;
    }
    if (autoSwitchQuantity === '1개 부착') {
        orderNumber += 'S';
    } else if (autoSwitchQuantity === 'N개 부착') {
        orderNumber += 'N';
    }

    const orderNumberElement = document.querySelector('.order-value');
    if (orderNumberElement) {
        orderNumberElement.textContent = orderNumber;
    }
}

// 계산
function calculateResults() {
    // 주문 품번 갱신 (표시 여부는 최종판정에 따름)
    generateOrderNumber();

    const gripMethod = document.getElementById('gripMethod').value;
    const diameter = document.getElementById('diameter').value;
    const pressure = document.getElementById('pressure').value;
    const load = parseFloat(document.getElementById('load').value);
    const safetyFactor = parseFloat(document.getElementById('safetyFactor').value);
    const gripPoint = parseFloat(document.getElementById('gripPoint').value);
    const overhang = parseFloat(document.getElementById('overhang').value);

    // 값 부족 시 초기화
    if (!gripMethod || !diameter || !pressure || isNaN(load) || isNaN(safetyFactor) || isNaN(gripPoint) || isNaN(overhang)) {
        document.getElementById('actualForce').textContent = '- N';
        document.getElementById('requiredForce').textContent = '- N';
        document.getElementById('progressBar').style.width = '0%';
        document.getElementById('progressBar').querySelector('.progress-text').textContent = '-%';
        document.getElementById('progressStatus').textContent = '-';

        document.getElementById('currentGripPoint').textContent = '- mm';
        document.getElementById('maxGripPoint').textContent = '- mm';
        document.getElementById('gripProgressBar').style.width = '0%';
        document.getElementById('gripProgressBar').querySelector('.progress-text').textContent = '-%';
        document.getElementById('gripProgressStatus').textContent = '-';

        const orderNumberElement = document.querySelector('.order-value');
        if (orderNumberElement) {
            orderNumberElement.classList.remove('show');
        }
        document.getElementById('finalResult').textContent = '값을 모두 입력하세요';
        document.getElementById('finalResult').style.backgroundColor = '#808080';
        return;
    }

    // STEP1: 파지력
    const actualForce = calculateEffectiveGripForce(diameter, parseFloat(pressure), gripMethod);
    const requiredForce = load * safetyFactor * 9.8;

    document.getElementById('actualForce').textContent = actualForce.toFixed(1) + ' N';
    document.getElementById('requiredForce').textContent = requiredForce.toFixed(1) + ' N';

    const ratio = (requiredForce / actualForce) * 100;
    document.getElementById('progressBar').style.width = Math.min(ratio, 100) + '%';
    document.getElementById('progressBar').querySelector('.progress-text').textContent = ratio.toFixed(1) + '%';
    if (ratio < 100) {
        document.getElementById('progressBar').style.backgroundColor = '#4CAF50';
        document.getElementById('progressStatus').textContent = '적용가능';
        document.getElementById('progressStatus').style.color = '#4CAF50';
    } else {
        document.getElementById('progressBar').style.backgroundColor = '#f44336';
        document.getElementById('progressStatus').textContent = '적용불가 (에어척 내경을 한 단계 크게 하거나 부하량을 축소하세요)';
        document.getElementById('progressStatus').style.color = '#f44336';
    }

    // STEP2: 파지점 + 오버행량
    const totalGripLength = gripPoint + overhang;
    const allowedRange = getAllowedRange(diameter, parseFloat(pressure), gripMethod);
    document.getElementById('currentGripPoint').textContent = totalGripLength.toFixed(1) + ' mm';
    document.getElementById('maxGripPoint').textContent = allowedRange.toFixed(1) + ' mm';

    const gripRatio = (totalGripLength / allowedRange) * 100;
    document.getElementById('gripProgressBar').style.width = Math.min(gripRatio, 100) + '%';
    document.getElementById('gripProgressBar').querySelector('.progress-text').textContent = gripRatio.toFixed(1) + '%';
    if (gripRatio <= 100) {
        document.getElementById('gripProgressBar').style.backgroundColor = '#4CAF50';
        document.getElementById('gripProgressStatus').textContent = '적용가능';
        document.getElementById('gripProgressStatus').style.color = '#4CAF50';
    } else {
        document.getElementById('gripProgressBar').style.backgroundColor = '#f44336';
        document.getElementById('gripProgressStatus').textContent = '적용불가 (에어척 내경을 한 단계 크게 하거나 파지점 또는 오버행량을 축소하세요)';
        document.getElementById('gripProgressStatus').style.color = '#f44336';
    }

    // 종합 판정 및 표시
    const isStep1Valid = ratio < 100;
    const isStep2Valid = gripRatio <= 100;
    const orderNumberElement = document.querySelector('.order-value');

    if (isStep1Valid && isStep2Valid) {
        document.getElementById('finalResult').textContent = '적용가능';
        document.getElementById('finalResult').style.backgroundColor = '#4CAF50';
        if (orderNumberElement) orderNumberElement.classList.add('show');
    } else {
        document.getElementById('finalResult').textContent = '적용불가 (에어척 내경을 한 단계 크게 하거나 파지점 또는 오버행량을 축소하세요)';
        document.getElementById('finalResult').style.backgroundColor = '#f44336';
        if (orderNumberElement) orderNumberElement.classList.remove('show');
    }
    
    // STEP3은 항상 표시
    document.getElementById('step3Section').style.display = 'block';
    calculateStep3();
}

// 이벤트
document.addEventListener('DOMContentLoaded', function() {
    const inputs = document.querySelectorAll('input, select');
    document.getElementById('gripMethod').addEventListener('change', function() {
        updateGripTypeImage();
        calculateResults();
    });
    document.getElementById('diameter').addEventListener('change', function() {
        updatePressureOptions();
        calculateResults();
    });
    inputs.forEach(el => {
        el.addEventListener('input', calculateResults);
        el.addEventListener('change', calculateResults);
    });
    updateGripTypeImage();
    updatePressureOptions();
    calculateResults();
});

// STEP 3 계산 (NFB2용)
function calculateStep3() {
    const diameter = document.getElementById('diameter').value;
    const load = parseFloat(document.getElementById('load').value);
    const safetyFactor = parseFloat(document.getElementById('safetyFactor').value);
    const gripPoint = parseFloat(document.getElementById('gripPoint').value);
    const overhang = parseFloat(document.getElementById('overhang').value);

    // NFB2 직경별 수직최대허용하중 
    const maxVerticalLoad = {
        '008': 65,
        '012': 93,
        '016': 193,
        '020': 259
    };

    // NFB2 직경별 허용횡하중 
    const maxLateralLoad = {
        '008': 20,
        '012': 28,
        '016': 57.9,
        '020': 78
    };

    // NFB2 직경별 허용 모멘트 (N.m)
    const maxPitchingMoment = {
        '008': 0.29,
        '012': 0.64,
        '016': 1.4,
        '020': 1.89
    };
    const maxRollingMoment = {
        '008': 0.59,
        '012': 1.32,
        '016': 3.1,
        '020': 3.77
    };

    // 허용적재중량계수 = 안전율 입력값
    const loadFactor = safetyFactor;
    // 허용모멘트계수: 1 고정
    const momentFactor = 1;

    const wMax = maxVerticalLoad[diameter] || 0;
    const allowedLoad = (wMax) / (safetyFactor || 1);
    const loadRatio = (load * 9.8) / (allowedLoad || 1);

    const pitchingForce = load * momentFactor * 9.8;
    const maxPitchingForce = maxLateralLoad[diameter] || 0;
    const pitchingMoment = (load * 9.8 * gripPoint * momentFactor) / 1000;
    const maxPitchingMomentValue = maxPitchingMoment[diameter] || 1;

    const rollingForce = load * 9.8;
    const maxRollingForce = maxLateralLoad[diameter] || 0;
    const rollingMoment = (load * 9.8 * overhang * momentFactor) / 1000;
    const maxRollingMomentValue = maxRollingMoment[diameter] || 1;
    
    // 취부자세에 따른 α2, α3 정의
    const mount = document.getElementById('mountOrientation').value;
    const altPitchingMoment = (load * 9.8 * overhang * momentFactor) / 1000; // Mp'
    const altRollingMoment = (safetyFactor * 9.8 * gripPoint * momentFactor) / 1000; // Mr'

    const alpha2 = (mount === '수평벽취부')
        ? (altPitchingMoment / (maxRollingMoment[diameter] || 1))
        : (pitchingMoment / (maxPitchingMomentValue || 1));

    const alpha3 = (mount === '수평벽취부')
        ? (altRollingMoment / (maxRollingMomentValue || 1))
        : (rollingMoment / (maxRollingMomentValue || 1));

    // 값 반영
    document.getElementById('allowedLoad').textContent = allowedLoad ? allowedLoad.toFixed(1) + ' N' : '- N';
    document.getElementById('loadFactor').textContent = isFinite(loadFactor) ? loadFactor : '-';
    document.getElementById('maxVerticalLoad').textContent = wMax ? (wMax + ' N') : '- N';
    document.getElementById('loadRatio').textContent = isFinite(loadRatio) ? loadRatio.toFixed(3) : '-';

    document.getElementById('pitchingForce').textContent = isFinite(pitchingForce) ? pitchingForce.toFixed(1) + ' N' : '- N';
    document.getElementById('maxPitchingForce').textContent = maxPitchingForce ? (maxPitchingForce + ' N') : '-';
    document.getElementById('pitchingMoment').textContent = isFinite(pitchingMoment) ? pitchingMoment.toFixed(3) + ' N.m' : '- N.m';
    document.getElementById('pitchingMomentAlt').textContent = isFinite(altPitchingMoment) ? altPitchingMoment.toFixed(3) + ' N.m' : '- N.m';
    document.getElementById('momentFactor').textContent = momentFactor;
    document.getElementById('maxPitchingMoment').textContent = isFinite(maxPitchingMomentValue) ? maxPitchingMomentValue.toFixed(2) + ' N.m' : '- N.m';
    // α2 표시값은 취부자세별 정의 사용
    const alpha2Display = mount === '수평벽취부'
        ? (( (load * 9.8 * overhang * momentFactor) / 1000) / (maxRollingMoment[diameter] || 1))
        : (pitchingMoment / (maxPitchingMomentValue || 1));
    document.getElementById('pitchingRatio').textContent = isFinite(alpha2Display) ? alpha2Display.toFixed(3) : '-';

    document.getElementById('rollingForce').textContent = isFinite(rollingForce) ? rollingForce.toFixed(1) + ' N' : '- N';
    document.getElementById('maxRollingForce').textContent = maxRollingForce ? (maxRollingForce + ' N') : '-';
    document.getElementById('rollingMoment').textContent = isFinite(rollingMoment) ? rollingMoment.toFixed(3) + ' N.m' : '- N.m';
    document.getElementById('rollingMomentAlt').textContent = isFinite(altRollingMoment) ? altRollingMoment.toFixed(3) + ' N.m' : '- N.m';
    document.getElementById('rollingMomentFactor').textContent = momentFactor;
    document.getElementById('maxRollingMoment').textContent = isFinite(maxRollingMomentValue) ? maxRollingMomentValue.toFixed(2) + ' N.m' : '- N.m';
    // α3 표시값은 취부자세별 정의 사용
    const alpha3Display = alpha3;
    document.getElementById('rollingRatio').textContent = isFinite(alpha3Display) ? alpha3Display.toFixed(3) : '-';

    // OK/NO: Pitching과 Rolling 모두 허용범위 이내일 때 OK
    const bothLoadsOK = (pitchingForce <= maxPitchingForce) && (rollingForce <= maxRollingForce);

    const pitchingCheckElement = document.getElementById('pitchingCheck');
    const rollingCheckElement = document.getElementById('rollingCheck');
    if (pitchingCheckElement) {
        pitchingCheckElement.textContent = bothLoadsOK ? 'OK' : 'NO';
        pitchingCheckElement.className = `force-result ${bothLoadsOK ? 'ok' : 'no'}`;
        pitchingCheckElement.parentElement.className = `force-check-item ${bothLoadsOK ? '' : 'failed'}`;
    }
    if (rollingCheckElement) {
        rollingCheckElement.textContent = bothLoadsOK ? 'OK' : 'NO';
        rollingCheckElement.className = `force-result ${bothLoadsOK ? 'ok' : 'no'}`;
        rollingCheckElement.parentElement.className = `force-check-item ${bothLoadsOK ? '' : 'failed'}`;
    }

    // 총 부하율
    const totalRatio = (isFinite(loadRatio) ? loadRatio : 0) + (isFinite(alpha2) ? alpha2 : 0) + (isFinite(alpha3) ? alpha3 : 0);
    const totalRatioEl = document.getElementById('totalRatio');
    totalRatioEl.textContent = isFinite(totalRatio) ? totalRatio.toFixed(3) : '-';
    totalRatioEl.style.color = totalRatio <= 1 ? '#4CAF50' : '#f44336';
}
</script>
</body>
</html>

